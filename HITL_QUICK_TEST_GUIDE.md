# 🚀 HITL 快速测试指南

## 5 分钟快速测试

### 步骤 1: 启动后端（终端 1）

```bash
cd ai-education-service
python -m uvicorn main:app --reload --port 8000
```

等待看到：
```
Uvicorn running on http://127.0.0.1:8000
```

### 步骤 2: 启动前端（终端 2）

```bash
cd 前端web
npm run dev
```

等待看到：
```
▲ Next.js running on http://localhost:3000
```

### 步骤 3: 打开浏览器

```
http://localhost:3000
```

### 步骤 4: 登录并进入对话

1. 输入账户信息登录
2. 选择一本书
3. 进入 book-chat-v2 页面

### 步骤 5: 打开开发者工具

按 `F12` 打开开发者工具，切换到"控制台"标签

### 步骤 6: 发送触发消息

在对话框输入：
```
保存我的学习笔记：今天学习了 HITL 功能
```

按 Enter 发送

## 预期结果 ✅

### 控制台日志
```
🤖 发送 AI 请求: {...}
🔗 保存 thread_id: thread_xxx
🛑 检测到 HITL 中断，显示审批模态框
```

### 页面显示
- [ ] 看到"正在输入..."状态
- [ ] HITL 审批模态框弹出
- [ ] 模态框显示操作信息
- [ ] 模态框显示决策按钮

## 测试决策

### 批准决策
1. 点击"批准"按钮（✓）
2. 点击"提交决策"
3. 模态框关闭
4. AI 继续执行
5. 看到 AI 回复

### 拒绝决策
1. 重复步骤 6
2. 点击"拒绝"按钮（✗）
3. 点击"提交决策"
4. 模态框关闭
5. 操作被跳过

### 编辑决策
1. 重复步骤 6
2. 点击"编辑"按钮（✎）
3. 修改 JSON 参数
4. 点击"保存编辑"
5. 点击"提交决策"
6. 修改后的参数被执行

## 故障排查

### 问题 1: 模态框不显示

**检查**:
1. 后端日志中是否有 `🛑 [Deep Agent] 检测到 HITL 中断`
2. 前端日志中是否有 `🛑 检测到 HITL 中断`
3. 浏览器控制台是否有错误

**解决**:
- 检查消息是否触发了 memory_write
- 重启后端和前端
- 查看浏览器网络标签

### 问题 2: 决策提交失败

**检查**:
1. 是否为所有操作做出了决策
2. 网络请求是否成功
3. 后端日志是否有错误

**解决**:
- 查看浏览器网络标签
- 查看后端日志
- 重新发送消息

### 问题 3: 恢复后没有响应

**检查**:
1. thread_id 是否正确
2. `/api/ai/chat/resume` 请求是否成功
3. 后端是否继续执行

**解决**:
- 查看浏览器网络标签
- 查看后端日志
- 重新发送消息

## 关键日志位置

### 后端日志
```
[Deep Agent] 检测到 HITL 中断
[API] 检测到 HITL 中断，转发给前端
[HITL Resume] 恢复执行
```

### 前端日志
```
🛑 检测到 HITL 中断，显示审批模态框
🔄 [AI Chat Resume] 恢复执行请求
✅ 恢复执行完成
```

## 成功标志

✅ **完全成功**
- 模态框显示
- 决策提交成功
- AI 继续执行
- 看到最终结果

---

**测试时间**: ___________  
**测试人员**: ___________  
**测试结果**: ✅ 通过 / ❌ 失败  
**备注**: _________________________________

