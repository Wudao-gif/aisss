# ğŸ‰ HITL æœ€ç»ˆä¿®å¤æ€»ç»“

## é—®é¢˜åˆ†æ

ç”¨æˆ·å‘é€ "ä¿å­˜æˆ‘çš„å­¦ä¹ ç¬”è®°ï¼šä»Šå¤©å­¦ä¹ äº† HITL åŠŸèƒ½" åï¼Œæ²¡æœ‰æ˜¾ç¤º HITL å®¡æ‰¹æ¨¡æ€æ¡†ã€‚

## æ ¹æœ¬åŸå› 

**è¯¯è§£äº† `interrupt_on` çš„å·¥ä½œåŸç†**ï¼š
- åˆå§‹é”™è¯¯ï¼šè®¤ä¸ºéœ€è¦åœ¨å·¥å…·å†…éƒ¨è°ƒç”¨ `interrupt()` å‡½æ•°
- æ­£ç¡®ç†è§£ï¼š`interrupt_on` é…ç½®ä¼šè‡ªåŠ¨åœ¨å·¥å…·æ‰§è¡Œå‰ä¸­æ–­ï¼Œæ— éœ€åœ¨å·¥å…·å†…éƒ¨è°ƒç”¨ `interrupt()`

## å®Œæˆçš„ä¿®å¤

### 1. ç®€åŒ– `memory_write` å·¥å…·
- **æ–‡ä»¶**: `ai-education-service/modules/langgraph/tools/memory.py`
- **ä¿®æ”¹**: ç§»é™¤äº†ä¸å¿…è¦çš„ `interrupt()` è°ƒç”¨
- **åŸå› **: `interrupt_on` é…ç½®å·²ç»è‡ªåŠ¨å¤„ç†äº†ä¸­æ–­é€»è¾‘

### 2. ç¡®è®¤ Deep Agent é…ç½®
- **æ–‡ä»¶**: `ai-education-service/modules/langgraph/deep_agent.py`
- **é…ç½®**: `interrupt_on` å·²æ­£ç¡®é…ç½®
- **ä¸­é—´ä»¶**: `HumanInTheLoopMiddleware` ç”± `create_deep_agent()` è‡ªåŠ¨æ·»åŠ 

### 3. ç¡®è®¤ API è·¯ç”±
- **æ–‡ä»¶**: `ai-education-service/api/routes.py`
- **åŠŸèƒ½**: `/chat/stream` æ­£ç¡®æ£€æµ‹å’Œè½¬å‘ä¸­æ–­äº‹ä»¶
- **åŠŸèƒ½**: `/chat/resume` æ­£ç¡®å¤„ç†ç”¨æˆ·å†³ç­–å¹¶æ¢å¤æ‰§è¡Œ

## å·¥ä½œæµç¨‹

```
ç”¨æˆ·å‘é€æ¶ˆæ¯
  â†“
Deep Agent æ‰§è¡Œ
  â†“
Agent å°è¯•è°ƒç”¨ memory_write å·¥å…·
  â†“
HumanInTheLoopMiddleware æ£€æµ‹åˆ° interrupt_on é…ç½®
  â†“
ä¸­æ–­æ‰§è¡Œï¼Œè¿”å› __interrupt__ äº‹ä»¶
  â†“
API è½¬å‘ __interrupt__ äº‹ä»¶ç»™å‰ç«¯
  â†“
å‰ç«¯æ˜¾ç¤º HITL å®¡æ‰¹æ¨¡æ€æ¡†
  â†“
ç”¨æˆ·åšå‡ºå†³ç­–
  â†“
å‰ç«¯å‘é€ /api/ai/chat/resume è¯·æ±‚
  â†“
åç«¯æ¢å¤æ‰§è¡Œ
  â†“
memory_write ç»§ç»­æ‰§è¡Œ
  â†“
ä¿å­˜æˆåŠŸ
```

## å…³é”®é…ç½®

### Deep Agent çš„ interrupt_on é…ç½®
```python
interrupt_on = {
    "memory_write": {
        "allowed_decisions": ["approve", "edit", "reject"],
        "description": "éœ€è¦å®¡æ‰¹ä¿å­˜çš„å­¦ä¹ è®°å½•"
    },
    "memory_read": False,
}
```

### å‰ç«¯ä¸­æ–­æ£€æµ‹
```typescript
if (data.type === '__interrupt__' && data.data) {
  // æ˜¾ç¤º HITL å®¡æ‰¹æ¨¡æ€æ¡†
  hitlActions.handleInterrupt(data.data)
}
```

## æµ‹è¯•æ­¥éª¤

1. **å¯åŠ¨åç«¯**
   ```bash
   cd ai-education-service
   python -m uvicorn main:app --reload --port 8000
   ```

2. **å¯åŠ¨å‰ç«¯**
   ```bash
   cd å‰ç«¯web
   npm run dev
   ```

3. **æµ‹è¯•æµç¨‹**
   - æ‰“å¼€ http://localhost:3000
   - ç™»å½•å¹¶è¿›å…¥ book-chat-v2
   - å‘é€: "ä¿å­˜æˆ‘çš„å­¦ä¹ ç¬”è®°ï¼šä»Šå¤©å­¦ä¹ äº† HITL åŠŸèƒ½"
   - åº”è¯¥çœ‹åˆ° HITL å®¡æ‰¹æ¨¡æ€æ¡†
   - ç‚¹å‡»"æ‰¹å‡†"æŒ‰é’®
   - è§‚å¯Ÿ AI ç»§ç»­æ‰§è¡Œå¹¶ä¿å­˜æˆåŠŸ

## é¢„æœŸç»“æœ

âœ… HITL å®¡æ‰¹æ¨¡æ€æ¡†æ˜¾ç¤º  
âœ… æ˜¾ç¤ºå¾…å®¡æ‰¹çš„æ“ä½œä¿¡æ¯  
âœ… ç”¨æˆ·å¯ä»¥æ‰¹å‡†/æ‹’ç»/ç¼–è¾‘  
âœ… å†³ç­–æäº¤å AI ç»§ç»­æ‰§è¡Œ  
âœ… æœ€ç»ˆæ˜¾ç¤º"è®°å¿†å­˜å‚¨æˆåŠŸ"  

## çŠ¶æ€

âœ… **ä¿®å¤å®Œæˆ**  
âœ… **ä»£ç å®¡æŸ¥é€šè¿‡**  
â³ **ç­‰å¾…æµ‹è¯•éªŒè¯**

---

**ä¿®å¤å®Œæˆæ—¶é—´**: 2025-12-12  
**ä¿®å¤äººå‘˜**: Augment Agent  
**çŠ¶æ€**: å®Œæˆå¹¶å°±ç»ªæµ‹è¯•

