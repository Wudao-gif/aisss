# 🧪 前端集成测试指南

**更新时间**: 2025-11-07  
**状态**: ✅ 后端 API 已完成并测试通过

---

## ✅ 已完成的工作

### 1️⃣ 后端 API 更新 ✅
- ✅ 更新 `lib/api/auth.ts` - 调用真实后端 API
- ✅ 添加 `login()` - 密码登录
- ✅ 添加 `loginWithCode()` - 验证码登录
- ✅ 更新 `register()` - 用户注册
- ✅ 添加 `getCurrentUserFromServer()` - 从服务器获取用户信息
- ✅ 移除 localStorage 模拟逻辑

### 2️⃣ 前端组件更新 ✅
- ✅ 更新 `EmailLogin.tsx` - 移除 localStorage 检查
- ✅ 简化邮箱验证流程
- ✅ 使用真实 API 进行登录和注册

### 3️⃣ API 测试 ✅
- ✅ 所有 API 端点测试通过
- ✅ 用户注册成功
- ✅ 用户登录成功
- ✅ 获取用户信息成功
- ✅ 数据库验证成功

---

## 🧪 API 测试结果

### 测试命令
```bash
node test-api.js
```

### 测试结果
```
✅ 获取大学列表 - 20 所大学
✅ 获取图书列表 - 3 本图书
✅ 用户注册 - 成功创建用户
✅ 获取用户信息 - 成功获取
✅ 密码登录 - 成功登录
✅ JWT Token - 正常生成和验证
```

---

## 🌐 前端测试步骤

### 步骤 1: 启动开发服务器

服务器已经在运行：
```
✅ 服务器地址: http://localhost:3001
✅ 状态: 运行中
```

### 步骤 2: 打开浏览器测试

1. **打开应用**:
   ```
   http://localhost:3001/new
   ```

2. **测试注册流程**:
   - 点击右上角"登录"按钮
   - 选择"邮箱登录"
   - 输入邮箱（例如：`user@example.com`）
   - 点击"继续"
   - 选择"注册新账号"
   - 输入验证码（任意 6 位数字，例如：`123456`）
   - 设置密码（至少 8 位）
   - 输入真实姓名
   - 选择大学
   - 跳过微信绑定
   - 完成注册

3. **测试登录流程**:
   - 退出登录
   - 点击"登录"按钮
   - 输入已注册的邮箱
   - 选择"密码登录"
   - 输入密码
   - 登录成功

---

## 📊 当前数据库状态

### 用户表
```sql
SELECT COUNT(*) FROM users;  -- 1 个测试用户
```

**测试用户**:
- 邮箱: `test@example.com`
- 密码: `12345678`
- 姓名: `测试用户`
- 大学: `四川大学`

### 大学表
```sql
SELECT COUNT(*) FROM universities;  -- 20 所大学
```

### 图书表
```sql
SELECT COUNT(*) FROM books;  -- 3 本图书
```

---

## 🔍 前端调试技巧

### 1. 查看网络请求

打开浏览器开发者工具（F12）：
1. 切换到 **Network** 标签
2. 筛选 **Fetch/XHR** 请求
3. 查看请求和响应数据

### 2. 查看 Console 日志

切换到 **Console** 标签：
- 查看是否有错误信息
- 查看 API 请求日志

### 3. 查看 localStorage

切换到 **Application** 标签：
- 展开 **Local Storage**
- 查看 `authToken` 和 `loggedInUser`

---

## ⚠️ 已知问题和注意事项

### 1. 验证码功能 ⚠️
**状态**: 暂未实现邮件发送  
**当前行为**: 任何 6 位数字都可以通过验证  
**后期需要**: 集成邮件服务（SendGrid、阿里云邮件等）

### 2. 邮箱检查 ⚠️
**状态**: 前端不再检查邮箱是否存在  
**当前行为**: 用户输入邮箱后，可以选择"登录"或"注册"  
**后端处理**: 
- 注册时检查邮箱是否已存在
- 登录时检查邮箱是否存在

### 3. 端口变化 ⚠️
**原计划**: 3002  
**实际端口**: 3001（因为 3000 被占用）  
**影响**: 无，API 调用使用相对路径

---

## 🐛 常见问题排查

### 问题 1: 注册失败 - "该邮箱已被注册"

**原因**: 邮箱已存在于数据库  
**解决**: 
1. 使用不同的邮箱
2. 或者删除测试用户：
   ```bash
   docker exec my-auth-postgres psql -U postgres -d user_auth_db -c "DELETE FROM users WHERE email='test@example.com';"
   ```

### 问题 2: 登录失败 - "密码错误"

**原因**: 密码不正确  
**解决**: 
1. 确认密码是否正确
2. 或者重新注册

### 问题 3: Token 验证失败

**原因**: Token 过期或无效  
**解决**: 
1. 清除 localStorage
2. 重新登录

### 问题 4: 网络请求失败

**原因**: 开发服务器未启动  
**解决**: 
```bash
npm run dev
```

---

## 📝 测试清单

### 注册流程 ✅
- [ ] 输入邮箱
- [ ] 验证邮箱格式
- [ ] 发送验证码（模拟）
- [ ] 输入验证码
- [ ] 设置密码
- [ ] 输入姓名
- [ ] 选择大学
- [ ] 跳过微信绑定
- [ ] 注册成功
- [ ] 自动登录
- [ ] 显示用户信息

### 登录流程 ✅
- [ ] 输入邮箱
- [ ] 选择密码登录
- [ ] 输入密码
- [ ] 登录成功
- [ ] 显示用户信息

### 验证码登录 ⏳
- [ ] 输入邮箱
- [ ] 选择验证码登录
- [ ] 发送验证码（模拟）
- [ ] 输入验证码
- [ ] 登录成功

### 登出流程 ✅
- [ ] 点击登出
- [ ] 清除用户信息
- [ ] 清除 Token
- [ ] 返回未登录状态

---

## 🚀 下一步

### 1. 完成前端测试 ⏱️ 10 分钟
- [ ] 在浏览器中测试注册流程
- [ ] 在浏览器中测试登录流程
- [ ] 验证用户信息显示正确

### 2. 集成图书和书架功能 ⏱️ 30 分钟
- [ ] 更新 `lib/api/books.ts`
- [ ] 调用真实图书 API
- [ ] 调用真实书架 API
- [ ] 测试图书列表
- [ ] 测试添加到书架
- [ ] 测试从书架移除

### 3. 完善功能 ⏱️ 1-2 小时
- [ ] 实现邮件验证码发送
- [ ] 添加密码强度验证
- [ ] 添加错误提示优化
- [ ] 添加加载状态

---

## 📞 需要帮助？

如果遇到问题，请提供：
1. 错误信息（Console 或 Network）
2. 操作步骤
3. 预期结果 vs 实际结果

---

## ✅ 总结

### 已完成 ✅
- ✅ 后端 API 完全集成
- ✅ 前端代码更新完成
- ✅ API 测试全部通过
- ✅ 数据库验证成功

### 待测试 ⏳
- ⏳ 浏览器端注册流程
- ⏳ 浏览器端登录流程
- ⏳ 用户信息显示

### 待完成 ⏳
- ⏳ 图书和书架 API 集成
- ⏳ 邮件验证码功能
- ⏳ 微信登录功能

---

**现在可以在浏览器中测试登录注册功能了！** 🎉

打开: `http://localhost:3001/new`

