# 资源管理逻辑说明

## 📊 核心数据关系（重要！）

### 正确的逻辑
1. **图书（Book）**：全局的，不属于任何大学
2. **资源（BookResource）**：属于特定大学
3. **关系**：
   - ✅ 一个资源只能绑定**一本教材**
   - ✅ 一个资源只能属于**一个大学**
   - ✅ 为多个大学创建资源 = 创建多份独立的资源记录

### 示例
**场景**：为《英语比赛-thalia liu》教材上传资源

**操作**：
- 选择教材：《英语比赛-thalia liu》（唯一）
- 选择大学：[北京大学, 清华大学]（多选）

**结果**：创建 2 份资源
- 资源1：北京大学 + 《英语比赛-thalia liu》
- 资源2：清华大学 + 《英语比赛-thalia liu》

---

## 🔧 API 接口

### 1. 创建资源（通用）
**路径**：`POST /api/admin/resources`

**请求参数**：
```json
{
  "bookId": "uuid",                    // 必填：教材ID（唯一）
  "universityIds": ["uuid1", "uuid2"], // 必填：大学ID数组（至少1个）
  "name": "资源名称",
  "description": "资源描述",
  "fileUrl": "https://...",
  "fileType": "pdf",
  "fileSize": 1024000,
  "allowReading": true
}
```

**逻辑**：
1. 验证必须选择一本教材
2. 验证必须选择至少一个大学
3. **为每个大学创建一份资源**
4. 每份资源都关联到同一本教材

---

### 2. 为图书添加资源（快捷方式）
**路径**：`POST /api/admin/books/{bookId}/resources`

**请求参数**：
```json
{
  "universityIds": ["uuid1", "uuid2"], // 必填：大学ID数组（至少1个）
  "name": "资源名称",
  "description": "资源描述",
  "fileUrl": "https://...",
  "fileType": "pdf",
  "fileSize": 1024000,
  "allowReading": true  // 可选，默认 true
}
```

**逻辑**：
- 自动使用 URL 中的 `bookId`
- 为每个大学创建一份资源

---

### 3. 更新资源
**路径**：`PATCH /api/admin/resources/{id}`

**请求参数**：
```json
{
  "name": "新名称",
  "description": "新描述",
  "allowReading": true
}
```

**限制**：
- ❌ 不能修改教材绑定
- ❌ 不能修改大学
- ✅ 只能修改基本信息

---

## ⚠️ 重要注意事项

1. **一个资源 = 一本教材 + 一个大学**
2. **创建后不能修改教材和大学**
3. **为多个大学创建 = 创建多份独立资源**
4. **每份资源都是独立的记录，可以单独编辑和删除**

---

## 📋 数据库结构

```
Book (图书 - 全局)
  ↓ (一对多)
BookResourceRelation (关联表)
  ↓ (多对一)
BookResource (资源 - 绑定大学)
  ↓ (多对一)
University (大学)
```

