# HITL 测试检查清单

## 📋 环境准备

### 后端环境
- [ ] Python 3.8+ 已安装
- [ ] 虚拟环境已激活
- [ ] 依赖已安装 (`pip install -r requirements.txt`)
- [ ] 后端可以启动 (`python -m uvicorn main:app --reload`)

### 前端环境
- [ ] Node.js 16+ 已安装
- [ ] npm/yarn 已安装
- [ ] 依赖已安装 (`npm install`)
- [ ] 前端可以启动 (`npm run dev`)

### 浏览器环境
- [ ] Chrome/Firefox/Safari 最新版本
- [ ] 开发者工具可用 (F12)
- [ ] 控制台可以查看日志

## 🚀 启动检查

### 后端启动
```bash
cd ai-education-service
python -m uvicorn main:app --reload --port 8000
```

- [ ] 看到 "Uvicorn running on http://127.0.0.1:8000"
- [ ] 访问 http://localhost:8000/docs 可以看到 API 文档
- [ ] 没有错误日志

### 前端启动
```bash
cd 前端web
npm run dev
```

- [ ] 看到 "▲ Next.js running on http://localhost:3000"
- [ ] 访问 http://localhost:3000 可以看到登录页面
- [ ] 没有编译错误

## 🧪 功能测试

### 1. 登录功能
- [ ] 能输入账户信息
- [ ] 能点击登录按钮
- [ ] 登录成功后跳转到主页
- [ ] 看到书架列表

### 2. 进入对话页面
- [ ] 能选择一本书
- [ ] 能进入 book-chat-v2 页面
- [ ] 页面加载完成
- [ ] 看到对话界面

### 3. 发送消息
- [ ] 能在输入框输入文本
- [ ] 能点击发送按钮
- [ ] 消息显示在对话区域
- [ ] 看到"正在输入..."状态

### 4. 接收 AI 回复
- [ ] AI 开始回复
- [ ] 看到流式文本更新
- [ ] 回复完成后显示完整内容
- [ ] 看到来源信息（如果有）

## 🎯 HITL 功能测试

### 5. 中断检测
- [ ] 发送触发 memory_write 的消息
- [ ] 看到"正在输入..."状态
- [ ] 控制台显示 "🛑 检测到 HITL 中断" 日志
- [ ] HITL 审批模态框弹出

### 6. 模态框显示
- [ ] 模态框显示在屏幕中央
- [ ] 模态框有标题（如"待审批操作"）
- [ ] 模态框显示操作信息
- [ ] 模态框显示决策按钮

### 7. 操作信息显示
- [ ] 显示操作名称（如 memory_write）
- [ ] 显示操作参数（JSON 格式）
- [ ] 参数格式正确
- [ ] 参数内容完整

### 8. 决策按钮
- [ ] 显示"批准"按钮（✓）
- [ ] 显示"拒绝"按钮（✗）
- [ ] 显示"编辑"按钮（✎）
- [ ] 显示"提交决策"按钮
- [ ] 所有按钮都可点击

## ✅ 决策测试

### 9. 批准决策
- [ ] 点击"批准"按钮
- [ ] 按钮变为蓝色/选中状态
- [ ] 点击"提交决策"
- [ ] 模态框关闭
- [ ] 控制台显示 "📤 提交 HITL 决策" 日志
- [ ] AI 继续执行
- [ ] 看到 AI 回复

### 10. 拒绝决策
- [ ] 重复步骤 5-8
- [ ] 点击"拒绝"按钮
- [ ] 按钮变为红色/选中状态
- [ ] 点击"提交决策"
- [ ] 模态框关闭
- [ ] 操作被跳过
- [ ] AI 继续执行

### 11. 编辑决策
- [ ] 重复步骤 5-8
- [ ] 点击"编辑"按钮
- [ ] 看到 JSON 编辑器
- [ ] 能修改参数值
- [ ] 点击"保存编辑"
- [ ] 编辑器关闭
- [ ] 点击"提交决策"
- [ ] 修改后的参数被执行

## 🔍 日志检查

### 控制台日志
- [ ] 看到 "🤖 发送 AI 请求" 日志
- [ ] 看到 "📡 响应状态: 200 OK" 日志
- [ ] 看到 "🔗 保存 thread_id" 日志
- [ ] 看到 "🛑 检测到 HITL 中断" 日志
- [ ] 看到 "📤 提交 HITL 决策" 日志
- [ ] 看到 "✅ 恢复执行完成" 日志

### 网络请求
- [ ] `/api/ai/chat` 请求成功 (200)
- [ ] 响应头包含 `X-Thread-ID`
- [ ] `/api/ai/chat/resume` 请求成功 (200)
- [ ] 请求体包含 `thread_id` 和 `decisions`

## 📊 性能测试

### 响应时间
- [ ] 中断检测 < 100ms
- [ ] 模态框显示 < 200ms
- [ ] 决策提交 < 500ms
- [ ] 恢复执行 < 1s

### 内存使用
- [ ] 没有内存泄漏
- [ ] 多次操作后内存稳定
- [ ] 没有控制台警告

## 🐛 错误处理

### 网络错误
- [ ] 后端离线时显示错误提示
- [ ] 网络中断时显示错误提示
- [ ] 错误提示清晰易懂

### 验证错误
- [ ] 决策验证失败时显示错误
- [ ] 参数验证失败时显示错误
- [ ] 错误信息有帮助

### 恢复错误
- [ ] 恢复失败时显示错误
- [ ] 可以重试恢复
- [ ] 错误不会导致页面崩溃

## 📱 跨浏览器测试

### Chrome
- [ ] 所有功能正常
- [ ] 没有控制台错误
- [ ] 性能良好

### Firefox
- [ ] 所有功能正常
- [ ] 没有控制台错误
- [ ] 性能良好

### Safari
- [ ] 所有功能正常
- [ ] 没有控制台错误
- [ ] 性能良好

## 🎊 最终检查

### 代码质量
- [ ] 没有 TypeScript 错误
- [ ] 没有 ESLint 警告
- [ ] 代码格式正确
- [ ] 注释清晰

### 文档完整性
- [ ] 有快速开始指南
- [ ] 有详细集成指南
- [ ] 有测试指南
- [ ] 有故障排除指南

### 部署就绪
- [ ] 所有测试通过
- [ ] 没有已知问题
- [ ] 可以部署到生产环境

---

## 📊 测试总结

**总项目数**: 60+  
**通过项目**: _____ / 60+  
**通过率**: _____%  

**测试日期**: ___________  
**测试人员**: ___________  
**备注**: _________________________________

---

**✅ 所有测试通过后，HITL 功能已验证就绪！**

